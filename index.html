<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>VoiceSafe – AI Voice Risk Analyzer</title>

<script src="https://cdn.tailwindcss.com"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"/>

<style>
.glass { backdrop-filter: blur(12px); background: rgba(255,255,255,.06); border: 1px solid rgba(255,255,255,.12); }
.shadow-soft { box-shadow: 0 18px 60px rgba(0,0,0,.35); }
.btn:disabled { opacity:.45; cursor:not-allowed; }
.progressBar { height:10px; border-radius:9999px; overflow:hidden; background:rgba(255,255,255,.12); }
.progressFill { height:100%; width:0%; background:linear-gradient(90deg,#f59e0b,#fde68a); transition:width .35s ease; }
.highRisk { color:#ef4444; }
.mediumRisk { color:#f59e0b; }
.lowRisk { color:#22c55e; }
</style>
</head>

<body class="min-h-screen text-white bg-slate-950">

<div class="fixed inset-0 -z-10">
<div class="absolute inset-0 bg-gradient-to-b from-slate-950 via-slate-950 to-black"></div>
</div>

<main class="max-w-5xl mx-auto px-4 py-10">

<div class="flex flex-col md:flex-row md:items-end md:justify-between gap-6">

<div>
<h1 class="text-3xl md:text-4xl font-extrabold tracking-tight">
<span class="text-amber-300">VoiceSafe</span> – AI Voice Risk Analyzer
</h1>
<p class="mt-2 text-slate-300 max-w-2xl">
Upload a voice sample and receive scam probability signals. Prototype build.
</p>
</div>

<div class="glass rounded-2xl p-4 shadow-soft">
<div class="text-xs text-slate-400 mb-1">Backend</div>
<div id="backendLabel" class="text-sm text-amber-300 font-mono"></div>
</div>

</div>

<div class="mt-8 grid grid-cols-1 lg:grid-cols-2 gap-6">

<section class="glass rounded-3xl p-6 shadow-soft">
<h2 class="text-xl font-bold mb-4">
<i class="fa-solid fa-file-audio text-amber-300 mr-2"></i>Analyze sample
</h2>

<input id="fileInput" type="file" accept="audio/*,video/*"
class="w-full rounded-xl bg-white/10 border border-white/10 px-4 py-3 focus:outline-none focus:ring-2 focus:ring-amber-400/60"/>

<div id="fileHint" class="mt-2 text-xs text-slate-400">No file selected</div>

<div class="flex gap-3 mt-4">
<button id="btnAnalyze"
class="btn px-5 py-3 rounded-xl bg-amber-500 text-black font-semibold hover:bg-amber-400 transition">
Analyze
</button>

<button id="btnClear"
class="btn px-5 py-3 rounded-xl bg-white/10 hover:bg-white/15 transition">
Clear
</button>
</div>

<div class="mt-4">
<div class="flex justify-between text-xs text-slate-400">
<span>Progress</span>
<span id="progressText">0%</span>
</div>
<div class="progressBar mt-1">
<div id="progressFill" class="progressFill"></div>
</div>
</div>

<div id="errorBox"
class="hidden mt-4 p-3 rounded-xl bg-red-500/15 border border-red-500/30 text-red-100 text-sm">
</div>

</section>

<section class="glass rounded-3xl p-6 shadow-soft">
<h2 class="text-xl font-bold mb-4">
<i class="fa-solid fa-chart-line text-amber-300 mr-2"></i>Results
</h2>

<div class="space-y-4">

<div>
<div class="text-xs text-slate-400">Scam Score</div>
<div id="scamScore" class="text-3xl font-extrabold">–</div>
</div>

<div>
<div class="text-xs text-slate-400">AI Voice Probability</div>
<div id="aiProb" class="text-3xl font-extrabold">–</div>
</div>

<div>
<div class="text-xs text-slate-400">Stress Level</div>
<div id="stress" class="text-3xl font-extrabold">–</div>
</div>

<div>
<div class="text-xs text-slate-400">Summary</div>
<div id="summaryText" class="mt-2 text-slate-200">
Upload sample to see analysis.
</div>
</div>

</div>
</section>

</div>

</main>

<script>
const BACKEND = "https://voicesafe-backend-1.onrender.com";
const MAX_SIZE_MB = 25;

const fileInput = document.getElementById("fileInput");
const fileHint = document.getElementById("fileHint");
const btnAnalyze = document.getElementById("btnAnalyze");
const btnClear = document.getElementById("btnClear");
const errorBox = document.getElementById("errorBox");
const progressFill = document.getElementById("progressFill");
const progressText = document.getElementById("progressText");

const scamScoreEl = document.getElementById("scamScore");
const aiProbEl = document.getElementById("aiProb");
const stressEl = document.getElementById("stress");
const summaryText = document.getElementById("summaryText");

document.getElementById("backendLabel").textContent = BACKEND;

function setProgress(v){
v=Math.max(0,Math.min(100,v));
progressFill.style.width=v+"%";
progressText.textContent=v+"%";
}

function setError(msg){
if(!msg){
errorBox.classList.add("hidden");
errorBox.textContent="";
return;
}
errorBox.textContent=msg;
errorBox.classList.remove("hidden");
}

function riskColor(el,val){
el.classList.remove("highRisk","mediumRisk","lowRisk");
if(val>=70) el.classList.add("highRisk");
else if(val>=40) el.classList.add("mediumRisk");
else el.classList.add("lowRisk");
}

btnAnalyze.disabled=true;

fileInput.addEventListener("change",()=>{
setError("");
const f=fileInput.files[0];
if(!f){ btnAnalyze.disabled=true; return; }

const sizeMB=f.size/1024/1024;
if(sizeMB>MAX_SIZE_MB){
setError("File too large (max 25MB)");
btnAnalyze.disabled=true;
return;
}

fileHint.textContent=`Selected: ${f.name} (${sizeMB.toFixed(2)} MB)`;
btnAnalyze.disabled=false;
});

btnClear.addEventListener("click",()=>{
fileInput.value="";
fileHint.textContent="No file selected";
btnAnalyze.disabled=true;
setProgress(0);
setError("");
scamScoreEl.textContent="–";
aiProbEl.textContent="–";
stressEl.textContent="–";
summaryText.textContent="Upload sample to see analysis.";
});

btnAnalyze.addEventListener("click",async()=>{
const f=fileInput.files[0];
if(!f) return;

btnAnalyze.disabled=true;
setProgress(10);
setError("");

const controller=new AbortController();
const timeout=setTimeout(()=>controller.abort(),60000);

try{
const form=new FormData();
form.append("file",f);

setProgress(30);

const resp=await fetch(`${BACKEND}/upload`,{
method:"POST",
body:form,
signal:controller.signal
});

if(!resp.ok) throw new Error("Server error "+resp.status);

setProgress(70);

const data=await resp.json();

const scam=Math.round(Number(data.scam_score)||0);
const ai=Math.round(Number(data.ai_voice_prob)||0);
const stress=Math.round(Number(data.stress_level)||0);

scamScoreEl.textContent=scam+"%";
aiProbEl.textContent=ai+"%";
stressEl.textContent=stress+"%";

riskColor(scamScoreEl,scam);
riskColor(aiProbEl,ai);
riskColor(stressEl,stress);

summaryText.textContent=data.summary || "Analysis completed.";

setProgress(100);

}catch(e){
if(e.name==="AbortError"){
setError("Server timeout (Render sleeping?) Try again.");
}else{
setError(e.message || "Analyze failed");
}
setProgress(0);
}
clearTimeout(timeout);
btnAnalyze.disabled=false;
});
</script>

</body>
</html>